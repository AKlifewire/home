{
 "Resources": {
  "DevicesTableD0A940EE": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "userId",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "UserDevicesIndex",
      "KeySchema": [
       {
        "AttributeName": "userId",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "id",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "userId",
      "KeyType": "RANGE"
     }
    ],
    "TableName": "SmartHomeDevices-dev"
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/DevicesTable/Resource"
   }
  },
  "DeviceStatusTable6D00E57F": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "deviceId",
      "AttributeType": "S"
     },
     {
      "AttributeName": "statusType",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "KeySchema": [
     {
      "AttributeName": "deviceId",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "statusType",
      "KeyType": "RANGE"
     }
    ],
    "TableName": "SmartHomeDeviceStatus-dev",
    "TimeToLiveSpecification": {
     "AttributeName": "ttl",
     "Enabled": true
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/DeviceStatusTable/Resource"
   }
  },
  "LambdaExecutionRoleD5C26073": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     },
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonSSMReadOnlyAccess"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/LambdaExecutionRole/Resource"
   }
  },
  "LambdaExecutionRoleDefaultPolicy6D69732F": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "iot:Connect",
        "iot:CreateThing",
        "iot:DeleteThing",
        "iot:DescribeThing",
        "iot:ListThings",
        "iot:Publish",
        "iot:Receive",
        "iot:Subscribe",
        "iot:UpdateThing"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "dynamodb:DeleteItem",
        "dynamodb:GetItem",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "DeviceStatusTable6D00E57F",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "DevicesTableD0A940EE",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "DevicesTableD0A940EE",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttOtaFirmwareBucket8CCE4052Arn99917228"
        },
        {
         "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttUiPageBucketACD75CDCArnA345B924"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttOtaFirmwareBucket8CCE4052Arn99917228"
           },
           "/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttUiPageBucketACD75CDCArnA345B924"
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttDeviceLogsBucketCE8D3AB0Arn56810752"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttDeviceLogsBucketCE8D3AB0Arn56810752"
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttOtaFirmwareBucket8CCE4052Arn99917228"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "dev-StorageStack:ExportsOutputFnGetAttOtaFirmwareBucket8CCE4052Arn99917228"
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdaExecutionRoleDefaultPolicy6D69732F",
    "Roles": [
     {
      "Ref": "LambdaExecutionRoleD5C26073"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/LambdaExecutionRole/DefaultPolicy/Resource"
   }
  },
  "getuipageFunctionFA3AEF0D": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Retrieves UI configuration for devices",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-get-ui-page",
    "Handler": "ui-page.handler",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-ui-pageFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "getuipageFunctionParam79BA4BF7": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-get-ui-page",
    "Type": "String",
    "Value": {
     "Ref": "getuipageFunctionFA3AEF0D"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-ui-pageFunctionParam/Resource"
   }
  },
  "getmydevicesFunction117EAF4A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Lists devices for a user",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-get-my-devices",
    "Handler": "devices.getDevices",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-my-devicesFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "getmydevicesFunctionParamD847A412": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-get-my-devices",
    "Type": "String",
    "Value": {
     "Ref": "getmydevicesFunction117EAF4A"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-my-devicesFunctionParam/Resource"
   }
  },
  "getdevicestateFunction3A1B79F6": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Gets current state of a device",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-get-device-state",
    "Handler": "devices.getDeviceState",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-device-stateFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "getdevicestateFunctionParamEDFA2F79": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-get-device-state",
    "Type": "String",
    "Value": {
     "Ref": "getdevicestateFunction3A1B79F6"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-device-stateFunctionParam/Resource"
   }
  },
  "controlrelayFunction4F3EACDB": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Controls device relays via MQTT",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-control-relay",
    "Handler": "control.relayControl",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/control-relayFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "controlrelayFunctionParam5C0E0528": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-control-relay",
    "Type": "String",
    "Value": {
     "Ref": "controlrelayFunction4F3EACDB"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/control-relayFunctionParam/Resource"
   }
  },
  "registerdeviceFunction9219CBCB": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Links a device to a user",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-register-device",
    "Handler": "devices.registerDevice",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/register-deviceFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "registerdeviceFunctionParam6BDE53E3": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-register-device",
    "Type": "String",
    "Value": {
     "Ref": "registerdeviceFunction9219CBCB"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/register-deviceFunctionParam/Resource"
   }
  },
  "removedeviceFunction84CF65FF": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Removes a device from a user",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-remove-device",
    "Handler": "devices.removeDevice",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/remove-deviceFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "removedeviceFunctionParam395002A0": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-remove-device",
    "Type": "String",
    "Value": {
     "Ref": "removedeviceFunction84CF65FF"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/remove-deviceFunctionParam/Resource"
   }
  },
  "deviceregistrationFunction0549453E": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Processes new device registrations",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-device-registration",
    "Handler": "iot.deviceRegistration",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/device-registrationFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "deviceregistrationFunctionParam98406EB7": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-device-registration",
    "Type": "String",
    "Value": {
     "Ref": "deviceregistrationFunction0549453E"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/device-registrationFunctionParam/Resource"
   }
  },
  "getanalyticsFunction6023DC98": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Retrieves device analytics data",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-get-analytics",
    "Handler": "analytics.getAnalytics",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-analyticsFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "getanalyticsFunctionParam1D79CD99": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-get-analytics",
    "Type": "String",
    "Value": {
     "Ref": "getanalyticsFunction6023DC98"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-analyticsFunctionParam/Resource"
   }
  },
  "getuijsonFunction64B3AB76": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Retrieves UI JSON configurations from S3",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "UI_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefUiPageBucketACD75CDC1A70A78F"
      },
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      },
      "USER_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      },
      "IDENTITY_POOL_ID": {
       "Fn::ImportValue": "dev-AuthStack:ExportsOutputRefIdentityPoolF5C140BA"
      },
      "OTA_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "LOGS_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefDeviceLogsBucketCE8D3AB0010B4F1E"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-get-ui-json",
    "Handler": "ui-json-handler.getUiJson",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 30
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-ui-jsonFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "getuijsonFunctionParamE6047F86": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-get-ui-json",
    "Type": "String",
    "Value": {
     "Ref": "getuijsonFunction64B3AB76"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/get-ui-jsonFunctionParam/Resource"
   }
  },
  "AutomationFunctionB1F18E3D": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Processes automation rules for devices",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "DEVICE_STATUS_TABLE": {
       "Ref": "DeviceStatusTable6D00E57F"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-automation",
    "Handler": "automation.processRules",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 60
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/AutomationFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "automationFunctionParam33BD9AA4": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-automation",
    "Type": "String",
    "Value": {
     "Ref": "AutomationFunctionB1F18E3D"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/automationFunctionParam/Resource"
   }
  },
  "OTAUpdateFunctionD9C14360": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-703671935952-us-east-1",
     "S3Key": "e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158.zip"
    },
    "Description": "Processes OTA firmware updates for devices",
    "Environment": {
     "Variables": {
      "STAGE": "dev",
      "DEVICES_TABLE": {
       "Ref": "DevicesTableD0A940EE"
      },
      "FIRMWARE_BUCKET": {
       "Fn::ImportValue": "dev-StorageStack:ExportsOutputRefOtaFirmwareBucket8CCE4052C90303CC"
      },
      "IOT_ENDPOINT": {
       "Fn::ImportValue": "dev-IoTStack:ExportsOutputFnGetAttDescribeIoTEndpointB53F1A7DendpointAddressAF0B54D1"
      }
     }
    },
    "FunctionName": "smart-home-dev-lambda-ota-update",
    "Handler": "ota.processUpdate",
    "Role": {
     "Fn::GetAtt": [
      "LambdaExecutionRoleD5C26073",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 60
   },
   "DependsOn": [
    "LambdaExecutionRoleDefaultPolicy6D69732F",
    "LambdaExecutionRoleD5C26073"
   ],
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/OTAUpdateFunction/Resource",
    "aws:asset:path": "asset.e1bc105be636f99d58d1b06958fab4a6f5c00b48b5a51c3a620ac7449ccc1158",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "otaupdateFunctionParam482F61BB": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Name": "smart-home-dev-lambda-ota-update",
    "Type": "String",
    "Value": {
     "Ref": "OTAUpdateFunctionD9C14360"
    }
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/ota-updateFunctionParam/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/+1ZS2/bMAz+LdWxUL0+tsNyc4ZsKNZtWeINGIIgoCU2VStLhiSnCwz/90GynWYINuxxMRqdRPCjTOoTacryZXLx+lVyfgKP9ozxhzMp8qSeO2APFB7tquZbBYXmeVJnkEtc1MT58SMUSEbklFBSgnHCCa3e45aMaqKeILctvTgnDSVWG/d7i1xIKdT6g+ZeNU2/raaT2Wo2+fxlMs8IJQYLvQE51VKwLRkRgw6EIg2tCXD+Tuoc5ByZVhzM9lpx/E5Gi5oIL/19vKXR98i8XdZq05sb0iy9t6ExQIkTBWb6Rmwwdc6IvHLt45slfXOrws41VECR1DMdNhGsrQrk4xBNaYRiogSZMqYr5brIWhs/IQ08tE+kpAAFa+QhCoE2kLyv26amt/0VsOw2LdP9Whb1vrIP6AB1DtjdtZJC4Q4jp+QPwH9wFtGIRvT/0PAC8u8Q2qp9Qe5qNdMeOSjhQzXncwcOC1TO/uQ2qqN6cOqQ8226N1RCkXNI6reVCl10URNTKd+wuzbL2m7vxTtQXKLpTwaiQF313diEkggiqo0wWnmXnYajZUaUuy5NyW3nbndM6YKd7M8NxbhXZEcBRvYj+0NgIrI/WJoi+88QjOxH9ofARGR/sDRF9p8heFTsH89iw0d2/1HdUHu1AmvR2ST1A7VXybhiD+jGYHGxpNYW/r+GEWo9BQMFOjSL2l/dt/Ledb4NVl9BVk/Li3YDsmvvV3rLpqEztLoyDPvsCBlCQyLMHayFWvsZnypXVq6hSnNM7u2LzeVlcvEyOT+5t0KcdZWTzNrxB/xN/FwYGwAA"
   },
   "Metadata": {
    "aws:cdk:path": "dev-LambdaStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "DevicesTableName": {
   "Description": "DynamoDB table for device management",
   "Value": {
    "Ref": "DevicesTableD0A940EE"
   },
   "Export": {
    "Name": "DevicesTableName-dev"
   }
  },
  "DeviceStatusTableName": {
   "Description": "DynamoDB table for device status",
   "Value": {
    "Ref": "DeviceStatusTable6D00E57F"
   },
   "Export": {
    "Name": "DeviceStatusTableName-dev"
   }
  },
  "DeviceRegistrationLambdaExport": {
   "Value": {
    "Fn::GetAtt": [
     "deviceregistrationFunction0549453E",
     "Arn"
    ]
   },
   "Export": {
    "Name": "smart-home-dev-lambda-device-registration"
   }
  },
  "ExportsOutputFnGetAttgetuipageFunctionFA3AEF0DArn291C4A66": {
   "Value": {
    "Fn::GetAtt": [
     "getuipageFunctionFA3AEF0D",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttgetuipageFunctionFA3AEF0DArn291C4A66"
   }
  },
  "ExportsOutputFnGetAttgetmydevicesFunction117EAF4AArn94499BB5": {
   "Value": {
    "Fn::GetAtt": [
     "getmydevicesFunction117EAF4A",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttgetmydevicesFunction117EAF4AArn94499BB5"
   }
  },
  "ExportsOutputFnGetAttgetdevicestateFunction3A1B79F6ArnE20F81C7": {
   "Value": {
    "Fn::GetAtt": [
     "getdevicestateFunction3A1B79F6",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttgetdevicestateFunction3A1B79F6ArnE20F81C7"
   }
  },
  "ExportsOutputFnGetAttcontrolrelayFunction4F3EACDBArn2D5AB674": {
   "Value": {
    "Fn::GetAtt": [
     "controlrelayFunction4F3EACDB",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttcontrolrelayFunction4F3EACDBArn2D5AB674"
   }
  },
  "ExportsOutputFnGetAttregisterdeviceFunction9219CBCBArn6C61C5AD": {
   "Value": {
    "Fn::GetAtt": [
     "registerdeviceFunction9219CBCB",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttregisterdeviceFunction9219CBCBArn6C61C5AD"
   }
  },
  "ExportsOutputFnGetAttremovedeviceFunction84CF65FFArn5D928992": {
   "Value": {
    "Fn::GetAtt": [
     "removedeviceFunction84CF65FF",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttremovedeviceFunction84CF65FFArn5D928992"
   }
  },
  "ExportsOutputFnGetAttgetanalyticsFunction6023DC98Arn9D1AEEE7": {
   "Value": {
    "Fn::GetAtt": [
     "getanalyticsFunction6023DC98",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttgetanalyticsFunction6023DC98Arn9D1AEEE7"
   }
  },
  "ExportsOutputFnGetAttgetuijsonFunction64B3AB76Arn447AFAB6": {
   "Value": {
    "Fn::GetAtt": [
     "getuijsonFunction64B3AB76",
     "Arn"
    ]
   },
   "Export": {
    "Name": "dev-LambdaStack:ExportsOutputFnGetAttgetuijsonFunction64B3AB76Arn447AFAB6"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}